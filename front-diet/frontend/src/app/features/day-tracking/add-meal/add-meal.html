<div class="add-meal-page">
  <header class="add-meal-header">
    <button class="back-link" (click)="onCancel()">‹ Retour</button>
    <div class="title-block">
      <!-- ✅ TITRE DYNAMIQUE -->
      <h1>{{ mealId ? 'Modifier le repas' : 'Ajouter un repas' }}</h1>
      <p class="subtitle">
        {{ date | date : 'EEEE d MMMM y' }}
      </p>
    </div>
  </header>

  <!-- ✅ ERREURS -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- ✅ LOADING -->
  <div *ngIf="loading" class="loading-overlay">
    <p>{{ mealId ? 'Chargement du repas...' : 'Enregistrement...' }}</p>
  </div>

  <!-- ✅ FORMULAIRE SANS formGroup -->
  <form class="form" (ngSubmit)="onSave()" *ngIf="!loading">
    <div class="field">
      <label>Type de repas</label>
      <select [(ngModel)]="type" name="type" required>
        <option value="BREAKFAST">Petit-déjeuner</option>
        <option value="LUNCH">Déjeuner</option>
        <option value="DINNER">Dîner</option>
        <option value="SNACK">Snack</option>
      </select>
    </div>

    <div class="field">
      <label>Heure</label>
      <input
        type="time"
        [(ngModel)]="time"
        name="time"
        required
      />
    </div>

    <div class="field">
      <label>Nom du repas / recette</label>
      <input
        type="text"
        [(ngModel)]="recipeName"
        name="recipeName"
        placeholder="Ex: Tajine poulet & olives"
        required
      />
    </div>

    <div class="field-inline">
      <div class="field">
        <label>Calories</label>
        <input
          type="number"
          [(ngModel)]="calories"
          name="calories"
          min="0"
          required
        />
      </div>
      <div class="field">
        <label>Portions</label>
        <input
          type="number"
          [(ngModel)]="servings"
          name="servings"
          min="0.1"
          step="0.1"
        />
      </div>
    </div>

    <div class="field-inline">
      <div class="field">
        <label>Protéines (g)</label>
        <input
          type="number"
          [(ngModel)]="protein"
          name="protein"
          min="0"
        />
      </div>
      <div class="field">
        <label>Glucides (g)</label>
        <input
          type="number"
          [(ngModel)]="carbs"
          name="carbs"
          min="0"
        />
      </div>
      <div class="field">
        <label>Lipides (g)</label>
        <input
          type="number"
          [(ngModel)]="fat"
          name="fat"
          min="0"
        />
      </div>
    </div>

    <div class="actions">
      <button
        type="button"
        class="btn-secondary"
        (click)="onCancel()"
      >
        Annuler
      </button>
      <!-- ✅ BOUTON DYNAMIQUE SANS ?.trim() -->
      <button 
        type="submit" 
        class="btn-primary" 
        [disabled]="loading || !recipeName || !recipeName.trim()">
        {{ loading ? (mealId ? 'Modification...' : 'Enregistrement...') : (mealId ? 'Modifier le repas' : 'Enregistrer le repas') }}
      </button>
    </div>
  </form>
</div>
